<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="./assets/katex.min.css">
        <link rel="stylesheet" href="./assets/fonts.css">
        <link rel="stylesheet" href="./main.css">

        <style>
          .euler {
            stroke-width: 2;
          }

          .euler.c1 {
            stroke: red;
            fill: rgba(255, 0, 0, 0.5);
          }

          .euler.c2 {
            stroke: green;
            fill: rgba(0, 255, 0, 0.5);
          }

          .euler.c3 {
            stroke: blue;
            fill: rgba(0, 0, 255, 0.5);
          }

          .euler.c4 {
            stroke: silver;
            fill: rgba(200, 200, 200, 0.5);
          }

          .c1 {
            color: red;
          }

          .c2 {
            color: green;
          }

          .s3 {
            color: red;
            fill: red;
          }

          .math {
            font: normal 1.21em KaTeX_Main,serif;
          }
        </style>
    </head>
    <body>
      <div id="container">
        <svg version="1.1" viewBox="-100 -100 200 200" xmlns="http://www.w3.org/2000/svg" class="eulersvg">
          <path class="euler c1" d="M -76.08452130361229 -39.72135954999577 A 15 15 0 0 0 -84.90130008799939 -12.586104634371551 L 38.20604139901077, 76.85661446562 A 15 15 0 0 0 61.28866792782517 69.35661446561998 L 90.35036904803958, -20.08610463437161 A 15 15 0 0 0 76.08452130361228 -39.72135954999581 L -76.08452130361229, -39.72135954999577"></path>
          <path class="euler c2" d="M -55.83959896778493 52.5861046343716 A 15 15 0 0 0 -38.20604139901073 76.85661446562003 L 84.90130008799937, -12.586104634371605 A 15 15 0 0 0 67.26774251922518 -36.85661446562003 L -55.83959896778493, 52.5861046343716"></path>
          <text x="-1.4695761589768237e-14" y="-80" class="label math" text-anchor="middle" dominant-baseline="middle" font-size="20px">0</text>
          <text x="76.08452130361228" y="-24.721359549995814" class="label math" text-anchor="middle" dominant-baseline="middle" font-size="20px">1</text>
          <text x="47.02282018339787" y="64.72135954999578" class="label math" text-anchor="middle" dominant-baseline="middle" font-size="20px">2</text>
          <text x="-47.02282018339783" y="64.72135954999581" class="label math" text-anchor="middle" dominant-baseline="middle" font-size="20px">3</text>
          <text x="-76.08452130361229" y="-24.721359549995764" class="label math" text-anchor="middle" dominant-baseline="middle" font-size="20px">4</text>
        </svg>
        <div><div><button class="euler_toggle in"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>∈</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">0 \in \htmlClass{c1}{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6835em;vertical-align:-0.0391em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="enclosing c1"><span class="mord mathnormal">A</span></span></span></span></span></button><button class="euler_toggle"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo mathvariant="normal">∉</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">1 \notin \htmlClass{c1}{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mord"><span class="mrel">∈</span></span><span class="mord vbox"><span class="thinbox"><span class="llap"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="inner"><span class="mord"><span class="mord">/</span><span class="mspace" style="margin-right:0.0556em;"></span></span></span><span class="fix"></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="enclosing c1"><span class="mord mathnormal">A</span></span></span></span></span></button><button class="euler_toggle in"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>∈</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">2 \in \htmlClass{c1}{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6835em;vertical-align:-0.0391em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="enclosing c1"><span class="mord mathnormal">A</span></span></span></span></span></button><button class="euler_toggle in"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mo>∈</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">3 \in \htmlClass{c1}{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6835em;vertical-align:-0.0391em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="enclosing c1"><span class="mord mathnormal">A</span></span></span></span></span></button><button class="euler_toggle"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mo mathvariant="normal">∉</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">4 \notin \htmlClass{c1}{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mord"><span class="mrel">∈</span></span><span class="mord vbox"><span class="thinbox"><span class="llap"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="inner"><span class="mord"><span class="mord">/</span><span class="mspace" style="margin-right:0.0556em;"></span></span></span><span class="fix"></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="enclosing c1"><span class="mord mathnormal">A</span></span></span></span></span></button></div><div><button class="euler_toggle"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo mathvariant="normal">∉</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">0 \notin \htmlClass{c2}{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mord"><span class="mrel">∈</span></span><span class="mord vbox"><span class="thinbox"><span class="llap"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="inner"><span class="mord"><span class="mord">/</span><span class="mspace" style="margin-right:0.0556em;"></span></span></span><span class="fix"></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="enclosing c2"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></span></button><button class="euler_toggle in"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>∈</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">1 \in \htmlClass{c2}{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6835em;vertical-align:-0.0391em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="enclosing c2"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></span></button><button class="euler_toggle in"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>∈</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">2 \in \htmlClass{c2}{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6835em;vertical-align:-0.0391em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="enclosing c2"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></span></button><button class="euler_toggle"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mo mathvariant="normal">∉</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">3 \notin \htmlClass{c2}{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mord"><span class="mrel">∈</span></span><span class="mord vbox"><span class="thinbox"><span class="llap"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="inner"><span class="mord"><span class="mord">/</span><span class="mspace" style="margin-right:0.0556em;"></span></span></span><span class="fix"></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="enclosing c2"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></span></button><button class="euler_toggle in"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mo>∈</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">4 \in \htmlClass{c2}{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6835em;vertical-align:-0.0391em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="enclosing c2"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></span></button></div></div>
        <div class="the_sets">
          <div><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>:</mo><mo>=</mo><mo stretchy="false">{</mo><mrow><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mn>4</mn><mo stretchy="false">}</mo></mrow></mrow><annotation encoding="application/x-tex">\htmlClass{c1}{A} := \lbrace{1, 2, 4\rbrace}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="enclosing c1"><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">4</span><span class="mclose">}</span></span></span></span></span></div>
          <div><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>:</mo><mo>=</mo><mo stretchy="false">{</mo><mrow><mn>1</mn><mo separator="true">,</mo><mn>3</mn><mo stretchy="false">}</mo></mrow></mrow><annotation encoding="application/x-tex">\htmlClass{c2}{B} := \lbrace{1, 3\rbrace}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="enclosing c2"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">3</span><span class="mclose">}</span></span></span></span></span></div>
        </div>
        <div class="results">

        </div>
      </div>

      <script src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js" integrity="sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p" crossorigin="anonymous"></script>

      <script>
        const svgns = "http://www.w3.org/2000/svg";
        const PI = Math.PI;
        const R = 15;

        function euler(container, compute_s3, render_results) {
          const s1 = [false, true, true, false, true];
          const s2 = [false, true, false, true, false];

          const svg = container.children[0];

          const p1 = svg.children[0];
          const p2 = svg.children[1];

          const svg_elements = [];
          for (let i = 0; i < 5; i++) {
            svg_elements.push(svg.children[2 + i]);
          }

          const buttons = container.children[1];
          const buttons1 = buttons.children[0];
          const buttons2 = buttons.children[1];

          for (let i = 0; i < 5; i++) {
            buttons1.children[i].addEventListener("click", () => {
              s1[i] = !s1[i];
              render_state();
            });

            buttons2.children[i].addEventListener("click", () => {
              s2[i] = !s2[i];
              render_state();
            });
          }

          const set1 = container.children[2].children[0];
          const set2 = container.children[2].children[1];

          const results = container.children[3];

          render_state();

          function render_state() {
            const s3 = compute_s3 ? compute_s3(s1, s2) : [false, false, false, false, false];

            draw_set(s1, p1);
            draw_set(s2, p2);

            for (let i = 0; i < 5; i++) {
              svg_elements[i].classList.toggle("s3", s3[i]);
            }

            for (let i = 0; i < 5; i++) {
              buttons1.children[i].classList.toggle("in", s1[i]);
              buttons1.children[i].innerHTML = button_text(i, 1, s1[i]);
              buttons2.children[i].classList.toggle("in", s2[i]);
              buttons2.children[i].innerHTML = button_text(i, 2, s2[i]);
            }

            set1.innerHTML = render_set_def(1, s1);
            set2.innerHTML = render_set_def(2, s2);

            if (render_results) {
              render_results(results, s1, s2, s3);
            }
          }
        }

        function name_set(set) {
          return `\\htmlClass{c${set}}{${set === 1 ? "A" : "B"}}`;
        }

        function button_text(element, set, is_in) {
          return tex_string(`${element} ${is_in ? "\\in" : "\\notin"} ${name_set(set)}`);
        }

        function render_set_def(set, s, s3) {
          return tex_string(`${name_set(set)} \\coloneqq ${set_tex(s, s3)}`);
        }

        function set_tex(s, s3_) {
          const s3 = s3_ ? s3_ : [false, false, false, false, false];

          const elements = s.reduce((acc, element, i) => {
            if (element) {
              if (s3[i]) {
                acc.push(`\\htmlClass{s3}{${i}}`);
              } else {
                acc.push(i);
              }
            }
            return acc;
          }, []);

          if (elements.length === 0) {
            return `\\emptyset`;
          } else {
            return `\\lbrace{${elements.join(", ")}\\rbrace}`;
          }
        }

        const tex_options = {trust: true};

        function tex_string(str) {
          return katex.renderToString(str, tex_options);
        }

        function tex(str, elem) {
          return katex.render(str, elem, tex_options);
        }

        function set_symmetric_difference(s1, s2) {
          const s3 = [];

          for (let i = 0; i < 5; i++) {
            s3.push(s1[i] != s2[i]);
          }

          return s3;
        }

        function render_results_relation(container, s1, s2, s3, rel_tex_src, not_rel_tex_src) {
          const s1_name = name_set(1);
          const s2_name = name_set(2);
          const set1 = set_tex(s1, s3);
          const set2 = set_tex(s2, s3);
          const rel = cardinality(s3) === 0 ? rel_tex_src : not_rel_tex_src;

          tex(`${s1_name} = ${set1} ${rel} ${set2} = ${s2_name}`, container);
        }

        const container = document.querySelector("#container");
        euler(container, set_symmetric_difference, (container, s1, s2, s3) => {
          return render_results_relation(container, s1, s2, s3, "=", "\\neq");
        });



        function polar_to_cartesian([x, y], r, t) {
          return [r * Math.cos(t) + x, r * Math.sin(t) + y];
        }

        function element_cartesian(i) {
          return polar_to_cartesian([0, 0], 80, (PI * 1.5) + ((2 * PI * i) / 5));
        }

        function svg_label(label, [x, y]) {
          const e = document.createElementNS(svgns, "text");
          e.setAttribute("x", x);
          e.setAttribute("y", y);
          e.setAttribute("class", "label");
          e.setAttribute("text-anchor", "middle");
          e.setAttribute("dominant-baseline", "middle");
          e.setAttribute("font-size", "20px");
          e.textContent = label;
          return e;
        };

        function svg_path(clazz) {
          const p = document.createElementNS(svgns, "path");
          p.setAttribute("class", clazz);
          return p;
        }

        // for (let i = 0; i < 5; i++) {
        //   svg.appendChild(svg_label(`${i}`, element_cartesian(i)));
        // }
        //
        // const s1 = [false, false, false, false, false];
        // const s2 = [true, false, false, false, false];
        // const s3 = [false, false, false, true, true];
        // const s4 = [true, true, true, false, true];
        //
        // const p1 = svg_path("euler c1");
        // const p2 = svg_path("euler c2");
        // const p3 = svg_path("euler c3");
        // const p4 = svg_path("euler c4");
        //
        // svg.appendChild(p1);
        // svg.appendChild(p2);
        // svg.appendChild(p3);
        // svg.appendChild(p4);
        //
        // draw_set(s1, p1);
        // draw_set(s2, p2);
        // draw_set(s3, p3);
        // draw_set(s4, p4);

        function cardinality(s) {
          let count = 0;
          s.forEach(x => {
            if (x) {
              count++;
            }
          });
          return count;
        }

        function set_first(s) {
          return set_next(s, 0);
        }

        function set_next(s, i) {
          for (let j = 1; j <= s.length; j++) {
            if (s[(i + j) % s.length]) {
              return (i + j) % s.length;
            }
          }

          throw "empty set has no next element";
        }

        function set_previous(s, i) {
          for (let j = s.length - 1; j >= 0; j--) {
            if (s[(i + j) % s.length]) {
              return (i + j) % s.length;
            }
          }

          throw "empty set has no previous element";
        }

        function draw_set(s, p) {
          const c = cardinality(s);

          if (c === 0) {
            p.setAttribute("d", "M0,0");
          } else if (c === 1) {
            const i = set_first(s);
            const [x, y] = element_cartesian(i);
            p.setAttribute("d", `${describe_arc([x, y], R, 0, PI, true)} ${describe_arc([x, y], R, PI, 0, false)}`);
          } else {
            const segments = [];
            let current = set_first(s);

            for (let i = 0; i < c; i++) {
              current = set_previous(s, current);
              const previous = set_previous(s, current);
              const next = set_next(s, current);

              const previous_cartesian = element_cartesian(previous);
              const current_cartesian = element_cartesian(current);
              const next_cartesian = element_cartesian(next);

              const angle_current_out = angle_to_y([next_cartesian, current_cartesian]);
              const angle_current_in = angle_to_y([current_cartesian, previous_cartesian]);

              segments.push(describe_arc(current_cartesian, R, angle_current_in, angle_current_out, i == 0));

              const angle_previous_out = angle_to_y([current_cartesian, previous_cartesian]);
              const previous_out_cartesian = polar_to_cartesian(previous_cartesian, R, angle_previous_out);

              segments.push(`L ${previous_out_cartesian[0]}, ${previous_out_cartesian[1]}`);
            }

            p.setAttribute("d", segments.join(" "));
          }
        }

        function angle_to_x([[x1, y1], [x2, y2]]) {
          return Math.atan2(y2 - y1, x2 - x1);
        }

        function angle_to_y(line) {
          return angle_to_x(line) + (PI * 0.5);
        }

        function describe_arc([x, y], radius, startAngle, endAngle, do_move){
          const [start_x, start_y] = polar_to_cartesian([x, y], radius, endAngle);
          const [end_x, end_y] = polar_to_cartesian([x, y], radius, startAngle);
          const largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";

          const d = !!do_move ? ["M", start_x, start_y] : [];
          return d.concat(["A", radius, radius, 0, largeArcFlag, 0, end_x, end_y]).join(" ");
      }

      </script>

    </body>
</html>
